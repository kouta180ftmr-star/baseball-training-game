<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>高校野球 選手育成ゲーム</title>
<style>
body { font-family: sans-serif; padding: 20px; background: #f3f8ff; }
h1 { text-align: center; }
button { padding: 15px; font-size: 18px; width: 100%; margin: 10px 0; border-radius: 10px; }
#status, #jobSelectArea { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 18px; }
</style>
</head>
<body>

<h1>高校野球 選手育成</h1>

<div id="jobSelectArea">
    <p>選手のタイプを選んでください：</p>
    <button onclick="selectJob('pitcher')">投手（ピッチャー）</button>
    <button onclick="selectJob('fielder')">野手</button>
</div>

<div id="status" style="display:none;"></div>

<div id="commandArea" style="display:none;">
    <button onclick="train('batting')">バッティング練習</button>
    <button onclick="train('pitching')">ピッチング練習</button>
    <button onclick="train('running')">走り込み</button>
    <button onclick="rest()">休養</button>
    <button onclick="match()">練習試合</button>

    <!-- 夏大会ボタン ※最初は非表示 -->
    <button id="tournamentBtn" onclick="playTournamentMatch()" style="display:none;">
        夏の大会 試合開始
    </button>
</div>

<script>
let player = {
    name: "",
    position: "",
    batting: 0,
    pitching: 0,
    speed: 0,
    stamina: 100,
    day: 1
};

let turnCount = 0;
let summerTournament = false;
let tournamentWins = 0;

/*--------------------------------
   初期ポジション選択
--------------------------------*/
function selectJob(job) {
    if (job === "pitcher") {
        player.position = "投手";
        player.name = "ゆうと";
        player.batting = 40;
        player.pitching = 60;
        player.speed = 45;
        alert("ゆうとを甲子園優勝にみちびこう！！");
    } else {
        player.position = "野手";
        player.name = "たいき";
        player.batting = 60;
        player.pitching = 30;
        player.speed = 55;
        alert("たいきを甲子園優勝にみちびこう！！");
    }

    document.getElementById("jobSelectArea").style.display = "none";
    document.getElementById("status").style.display = "block";
    document.getElementById("commandArea").style.display = "block";
    showStatus();
}

/*--------------------------------
   ステータス表示
--------------------------------*/
function showStatus(){
    document.getElementById("status").innerHTML = `
        <b>【${player.day}日目】</b><br>
        名前：${player.name}<br>
        ポジション：${player.position}<br>
        バッティング：${player.batting}<br>
        ピッチング：${player.pitching}<br>
        走力：${player.speed}<br>
        体力：${player.stamina}
    `;
}

/*--------------------------------
   ターン処理
--------------------------------*/
function nextTurn(){
    turnCount++;
    if(turnCount >= 50 && !summerTournament){
        summerTournament = true;
        alert("夏の甲子園イベントが始まった！");
        startTournament();
    }
}

/*--------------------------------
   練習
--------------------------------*/
function train(type){
    if(player.stamina <= 10){
        alert("体力がない…休もう！");
        return;
    }

    if(type === "batting"){
        player.batting += 5;
        alert("バッティング練習！");
    }
    else if(type === "pitching"){
        player.pitching += 5;
        alert("ピッチング練習！");
    }
    else if(type === "running"){
        player.speed += 4;
        alert("走り込み！");
    }

    player.stamina -= 15;
    player.day++;
    nextTurn();
    showStatus();
    checkEvent();
}

/*--------------------------------
   休養
--------------------------------*/
function rest(){
    player.stamina = 100;
    alert("体力が全回復！");
    player.day++;
    nextTurn();
    showStatus();
    checkEvent();
}

/*--------------------------------
   練習試合
--------------------------------*/
function match(){
    // 体力の影響を追加（0.0〜1.0）
    let staminaRate = player.stamina / 100;

    // 能力 + 体力補正 + ランダム
    let total = 
        (player.batting + player.pitching + player.speed) * staminaRate
        + Math.floor(Math.random() * 40);

    let enemy = 160 + Math.floor(Math.random() * 40); // 相手の強さ

    if(total > enemy){
        alert("練習試合に勝利！能力値 +30");
        player.batting += 30;
        player.pitching += 30;
        player.speed += 30;
    } else {
        alert("練習試合に負けた…能力値 -20");
        player.batting = Math.max(player.batting - 20, 0);
        player.pitching = Math.max(player.pitching - 20, 0);
        player.speed = Math.max(player.speed - 20, 0);
    }

    // 試合後の体力消費
    player.stamina -= 25;
    if(player.stamina < 0) player.stamina = 0;

    player.day++;
    nextTurn();
    showStatus();
    checkEvent();
}

/*--------------------------------
   ランダムイベント
--------------------------------*/
function checkEvent(){
    if(Math.random() < 0.1){
        randomEvent();
    }
}

function randomEvent(){
    const events = ["injury", "super", "praise", "girl"];
    let e = events[Math.floor(Math.random()*events.length)];

    if(e==="injury"){
        alert("練習中に軽いケガ…体力が20減少！");
        player.stamina -= 20;
    }
    if(e==="super"){
        alert("今日は絶好調！すべての能力が上昇！");
        player.batting += 2;
        player.pitching += 2;
        player.speed += 2;
    }
    if(e==="praise"){
        alert("監督に褒められた！体力が20回復！");
        player.stamina += 20;
    }
    if(e==="girl"){  
        if(Math.random() < 0.01){  
            if(Math.random() < 0.5){
                alert("彼女ができた！全能力値 +50");
                player.batting += 50;
                player.pitching += 50;
                player.speed += 50;
            } else {
                alert("彼女はできなかった…全能力値 -50");
                player.batting = Math.max(player.batting - 50, 0);
                player.pitching = Math.max(player.pitching - 50, 0);
                player.speed = Math.max(player.speed - 50, 0);
            }
        }
    }

    if(player.stamina > 100) player.stamina = 100;
    if(player.stamina < 0) player.stamina = 0;

    showStatus();
}

/*--------------------------------
   夏の大会開始
--------------------------------*/
function startTournament(){
    tournamentWins = 0;
    document.getElementById("tournamentBtn").style.display = "block";
    alert("夏の大会が始まる！『夏の大会 試合開始』で試合を進めよう！");
}

/*--------------------------------
   夏の大会 1試合（1クリックで1試合）
--------------------------------*/
function playTournamentMatch(){
    const requiredPoints = 100 + tournamentWins * 20;
    let total = player.batting * 0.4 + player.pitching * 0.4 + player.speed * 0.2;

    let winRate = (total >= requiredPoints) ? 0.9 : 0.1;

    if(Math.random() < winRate){
        tournamentWins++;
        alert(`試合に勝利！能力値 +20（現在 ${tournamentWins}勝）`);
        player.batting += 20;
        player.pitching += 20;
        player.speed += 20;

        if(tournamentWins === 3) alert("地区大会突破！");
        if(tournamentWins === 4){
            alert("甲子園優勝！おめでとう！");
            document.getElementById("tournamentBtn").style.display = "none";
            return;
        }

    } else {
        alert("試合に負けた…ゲームオーバー！1日目からやり直し！");
        player.batting = 0;
        player.pitching = 0;
        player.speed = 0;
        player.stamina = 100;
        player.day = 1;
        turnCount = 0;
        summerTournament = false;
        tournamentWins = 0;
        document.getElementById("tournamentBtn").style.display = "none";
        showStatus();
        return;
    }

    showStatus();
}
</script>

</body>
</html>
